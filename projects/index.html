<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Bradley Sansom</title>

    <meta name="description"
        content="Hi! I like to make things. I'm a designer, a creator, a developer, and many things besides, from Manchester, UK.">

    <!-- Facebook Meta Tags -->
    <meta property="og:url" content="https://bradleysans.uk">
    <meta property="og:type" content="website">
    <meta property="og:title" content="Bradley Sansom">
    <meta property="og:description"
        content="Hi! I like to make things. I'm a designer, a creator, a developer, and many things besides, from Manchester, UK.">
    <meta property="og:image" content="https://bradleysans.uk/thumbnail.png">

    <!-- Twitter Meta Tags -->
    <meta name="twitter:card" content="summary_large_image">
    <meta property="twitter:domain" content="bradleysans.uk">
    <meta property="twitter:url" content="https://bradleysans.uk">
    <meta name="twitter:title" content="Bradley Sansom">
    <meta name="twitter:description"
        content="Hi! I like to make things. I'm a designer, a creator, a developer, and many things besides, from Manchester, UK.">
    <meta name="twitter:image" content="https://bradleysans.uk/thumbnail.png">
    <link rel="stylesheet" href="../styles/style.css">

    <link rel="stylesheet" href="../styles/fonts.css">
</head>

<body>
    <header role="header" name="header">
        <h1 class="name">Bradley Sansom</h1>
        <nav class="animated">
            <ul>
                <li>
                    <a href="mailto:bradley-sansom@outlook.com" rel="me">
                        <figure class="nav-icon" id="email" title="Send me an email"><span class="icon-mail"></span>
                        </figure>
                    </a>
                </li>
                <li>
                    <a href="https://github.com/bradleysansom" rel="me">
                        <figure class="nav-icon" id="github" title="GitHub"><span class="icon-github"></span></figure>
                    </a>
                </li>
                <li>
                    <a href="https://linkedin.com/in/bradleysans" rel="me">
                        <figure class="nav-icon" id="linkedin" title="LinkedIn"><span class="icon-linkedin"></span>
                        </figure>
                    </a>
                </li>
                <li>
                    <a href="https://twitter.com/bradleysans" rel="me">
                        <figure class="nav-icon" id="twitter" title="Twitter"><span class="icon-twitter"></span>
                        </figure>
                    </a>
                </li>
                <li>
                    <a href="https://instagram.com/bradleysans" rel="me">
                        <figure class="nav-icon" id="instagram" title="Instagram"><span class="icon-instagram"></span>
                        </figure>
                    </a>
                </li>
                <li>
                    <a href="https://mastodon.me.uk/@bradleysans" rel="me">
                        <figure class="nav-icon" id="mastodon" title="Mastodon"><span class="icon-mastodon"></span>
                        </figure>
                    </a>
                </li>

            </ul>
        </nav>
    </header>
    <hr>
    <main>

        <article id="crystaliser">
            <h4 class="headline" id="headline"></h4>
            <img id="carousel" width="100%" height="250px"></img>
            <section class="beneath">
                <section class="comment">
                    <aside class="attribution">
                        <p class="unit"></p>
                        <p class="institution"></p>
                    </aside>
                    <p class="blurb"></p>
                </section>
                <section class="controls">
                    <section class="arrows">
                        <button class="left-arrow" title="Previous image"><span class="material-symbols-outlined">
                                <span class="icon-arrow-left"></span>
                            </span></button>
                        <button class="right-arrow" title="Next image"><span class="material-symbols-outlined">
                                <span class="icon-arrow-right"></span>
                            </span></button>
                    </section>
                    <button class="link" id="visitButton"><span id="linkText"></span><span
                            class="material-symbols-outlined">
                            <span class="icon-chevron-right"></span>
                        </span></button>
                </section>

            </section>

        </article>
    </main>

</body>

<!-- <script src="/scripts/project.js"></script> -->
<script src="/scripts/xml2json.js"></script>
<script>
    var headline;
    var image;
    var unit;
    var institution;
    var blurb;
    var linkText;
    var rightBtn;
    var leftBtn;
    var button;

    var currentCategory;
    var currentSubCategory;

    var filtered;
    var projects;
    var projectsArray;
    var projectsArrayTwo

    var url;
    var currentProject;

    var categoryArray;
    var subCategoryArray;

    var myOptions = {
        mergeCDATA: true,
        xmlns: false,
        attrsAsObject: false,
        stripAttrPrefix: true,
        childrenAsArray: false,
        textKey: 'text'
    }

    function getCurrentProject() {
        url = window.location.href;
        currentProject = url.split('?')[1]
        console.log(currentProject);
        projectPageInitialise();

    }

    function projectPageInitialise() {
        headline = document.getElementsByClassName("headline")[0];
        image = document.getElementById("carousel");
        unit = document.getElementsByClassName("unit")[0];
        institution = document.getElementsByClassName("institution")[0];
        blurb = document.getElementsByClassName("blurb")[0];
        linkText = document.getElementById("linkText");
        rightBtn = document.getElementsByClassName("right-arrow")[0];
        leftBtn = document.getElementsByClassName("left-arrow")[0];
        button = document.getElementById("visitButton");
        fetchPosts("project");
    }

    function projectPageRender() {
        headline.innerHTML = filtered[0].title.text;
        image.backgroundImage = "url(" + filtered[0].images[0].text + ");";
        unit.innerHTML = filtered[0].unit.text;
        institution.innerHTML = filtered[0].institution.text;
        blurb.innerHTML = filtered[0].blurb.text;
        linkText.innerHTML = filtered[0].linkLabel.text;

        var pictures = filtered[0].images;
        var link = filtered[0].link.text;

        let position = 0;
        const moveRight = () => {
            console.log('moveRight');
            if (position >= pictures.length - 1) {
                position = 0
                image.src = pictures[position].text;
                return;
            }
            image.src = pictures[position + 1].text;
            position++;
        }
        const moveLeft = () => {
            console.log('moveLeft');
            if (position < 1) {
                position = pictures.length - 1;
                image.src = pictures[position].text;
                return;
            }
            image.src = pictures[position - 1].text;
            position--;
        }

        rightBtn.addEventListener("click", moveRight);
        leftBtn.addEventListener("click", moveLeft);
        const visit = () => {
            window.location.href = link;
        }
        visitButton.addEventListener("click", visit);
    }




    function homePageInitialise(category, subCategory) {
        fetchPosts("homePage", category, subCategory);
    }

    function homePageRender(projectsArray) {


    }


    async function fetchPosts(pageType, category, subCategory) {
        let response = await fetch("https://bradleysans.uk/projects/posts.xml");

        if (response.ok) { // if HTTP-status is 200-299
            // get the response body (the method explained below)
            projects = await response.text();
            // console.log(projects);
            projectsArray = xmlToJSON.parseString(projects, myOptions).rss.channel.item;
            console.log(projectsArray);
            filtered = projectsArray.filter(project => project.guid.text.split("?")[1] == currentProject);
            console.log(filtered);
            if (filtered.length === 0) {
                projectNotFound();
            } else {
                if (pageType === "project") {
                    console.log("page type: project");
                    projectPageRender();
                } else if (pageType === "homePage") {
                    console.log("page type: homepage");
                    homePageRender(category, subCategory);
                }
            }





        } else {
            alert("HTTP-Error: " + response.status);
        }
    }
    function projectNotFound() {
        console.log("project not found");
        document.getElementById("headline").innerHTML = "Project not found";
    }

    getCurrentProject();




</script>

</html>